Может быть авторы со мной не согласятся, но я считаю, что следующая информация должна быть в описании задачи. Даже с учетом того, что я докопался до этих моментов, я набрал лишь 24/25, и не вижу вариантов как отладить последний балл.

Надеюсь, эта информация кому-то поможет. Также было бы неплохо, если студенты, столкнувшиеся с другими сложными случаями, делились бы своим опытом. Вывод грейдера, безусловно, отвратителен. Лишь телепат понял бы, что разрешен лишь один запрос на чтение, что нельзя делать GET-запрос, пока форма невалидна, и т.д. Это те вещи, которые ВООБЩЕ не влияют на результат. Если конечно попытаться подключить здравый смысл.

1. Делайте лишь один GET-запрос для получения данных из API на каждый запрос к вашему приложению.

2. Делайте не более одного POST-запроса на изменение данных в API на каждый запрос к вашему приложению. Если параметры света в форме не изменились - не надо их отправлять в API. Все это относится и к задаче в celery.

3. Обязательно отрабатывайте вариант, когда ваши запросы к API заканчиваются неудачно.

4. Помните, что запросы requests могут как бросать исключения, так и просто возвращать ответ с ошибочным кодом.

5. Пока форма невалидна в POST-запросе - не делайте каких-либо запросов к API. Грейдер не оценит такого внимания.

////////////////////////////////////////////////////////////////////////////////

Меня просто съела ошибка "smart_home_manager task does not send request in certian conditions". В итоге, нужно в smart_home_manager (ну или в вызываемых методах) сохранять значения light_* в db и в последующем сверять новые значения с сохраненным. POST на API делать только если из формы значение в db перезаписано. По-видимому, это описывается как "синхронизировать значение с контроллером" в задании.

////////////////////////////////////////////////////////////////////////////////
И моя одна грабля. Хотя я так и понял смысла всего этого задания с такими условиями.
Как сделал:

Запрашиваем данные с контроллера. Рисуем по ним форму. Пользователь тормоз полгода чешет репу, и вводит данные. Поэтому перед отправкой снова считываем данные, ибо там уже десять раз могла дымовая обстановка изменится. И на основании свежих данных отправляем смену электрического света.


Не прокатывает такой логичный вариант. Видать "лишний" запрос тестируемая система не пропускает. Переделал на:

Запрашиваем данные с контроллера. Рисуем по ним форму. Пользователь тормоз полгода чешет репу, и вводит данные. На основании устаревших данных отправляем смену электрического света.

Прошло. Хотя в задании написано "ни при каких условиях не включать их, пока дым не исчезнет". Поэтому я и добавил эту проверку.

////////////////////////////////////////////////////////////////////////////////

Моя коллекция граблей:

1. Архивируем не папку core, а ее содержимое, самой папки core в архиве быть не должно: это может быть причиной 0/25

2. smart_home_manager task sends request to close cold and hot water valves and disable washing machine and boiler if leak is detected - этот тест выдает ошибку как в случае неправильной логики обработки данных с контроллеров и тогда снимает много баллов, так и в случае если есть проблема с отсылкой уведомления о протечке, по уведомлению снимает 1 балл. Сначала я использовал рекомендованную в задании функцию send_mail, ловил ошибку (хотя почта ходила на самом деле). Сменив метод на

EmailMessage с 3-мя аргументами (тема тело кому), грейдер пропускал нормально такое решение.
